//ç»™ä½ ä¸€ä¸ªç”¨å­—ç¬¦æ•°ç»„ tasks è¡¨ç¤ºçš„ CPU éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨ã€‚å…¶ä¸­æ¯ä¸ªå­—æ¯è¡¨ç¤ºä¸€ç§ä¸åŒç§ç±»çš„ä»»åŠ¡ã€‚ä»»åŠ¡å¯ä»¥ä»¥ä»»æ„é¡ºåºæ‰§è¡Œï¼Œå¹¶ä¸”æ¯ä¸ªä»»åŠ¡éƒ½å¯ä»¥åœ¨ 1 ä¸ª
//å•ä½æ—¶é—´å†…æ‰§è¡Œå®Œã€‚åœ¨ä»»ä½•ä¸€ä¸ªå•ä½æ—¶é—´ï¼ŒCPU å¯ä»¥å®Œæˆä¸€ä¸ªä»»åŠ¡ï¼Œæˆ–è€…å¤„äºå¾…å‘½çŠ¶æ€ã€‚ 
//
// ç„¶è€Œï¼Œä¸¤ä¸ª ç›¸åŒç§ç±» çš„ä»»åŠ¡ä¹‹é—´å¿…é¡»æœ‰é•¿åº¦ä¸ºæ•´æ•° n çš„å†·å´æ—¶é—´ï¼Œå› æ­¤è‡³å°‘æœ‰è¿ç»­ n ä¸ªå•ä½æ—¶é—´å†… CPU åœ¨æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ï¼Œæˆ–è€…åœ¨å¾…å‘½çŠ¶æ€ã€‚ 
//
// ä½ éœ€è¦è®¡ç®—å®Œæˆæ‰€æœ‰ä»»åŠ¡æ‰€éœ€è¦çš„ æœ€çŸ­æ—¶é—´ ã€‚ 
//
// 
//
// ç¤ºä¾‹ 1ï¼š 
//
// 
//è¾“å…¥ï¼štasks = ["A","A","A","B","B","B"], n = 2
//è¾“å‡ºï¼š8
//è§£é‡Šï¼šA -> B -> (å¾…å‘½) -> A -> B -> (å¾…å‘½) -> A -> B
//     åœ¨æœ¬ç¤ºä¾‹ä¸­ï¼Œä¸¤ä¸ªç›¸åŒç±»å‹ä»»åŠ¡ä¹‹é—´å¿…é¡»é—´éš”é•¿åº¦ä¸º n = 2 çš„å†·å´æ—¶é—´ï¼Œè€Œæ‰§è¡Œä¸€ä¸ªä»»åŠ¡åªéœ€è¦ä¸€ä¸ªå•ä½æ—¶é—´ï¼Œæ‰€ä»¥ä¸­é—´å‡ºç°äº†ï¼ˆå¾…å‘½ï¼‰çŠ¶æ€ã€‚ 
//
// ç¤ºä¾‹ 2ï¼š 
//
// 
//è¾“å…¥ï¼štasks = ["A","A","A","B","B","B"], n = 0
//è¾“å‡ºï¼š6
//è§£é‡Šï¼šåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä»»ä½•å¤§å°ä¸º 6 çš„æ’åˆ—éƒ½å¯ä»¥æ»¡è¶³è¦æ±‚ï¼Œå› ä¸º n = 0
//["A","A","A","B","B","B"]
//["A","B","A","B","A","B"]
//["B","B","B","A","A","A"]
//...
//è¯¸å¦‚æ­¤ç±»
// 
//
// ç¤ºä¾‹ 3ï¼š 
//
// 
//è¾“å…¥ï¼štasks = ["A","A","A","A","A","A","B","C","D","E","F","G"], n = 2
//è¾“å‡ºï¼š16
//è§£é‡Šï¼šä¸€ç§å¯èƒ½çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼š
//     A -> B -> C -> A -> D -> E -> A -> F -> G -> A -> (å¾…å‘½) -> (å¾…å‘½) -> A -> (å¾…
//å‘½) -> (å¾…å‘½) -> A
// 
//
// 
//
// æç¤ºï¼š 
//
// 
// 1 <= task.length <= 10â´ 
// tasks[i] æ˜¯å¤§å†™è‹±æ–‡å­—æ¯ 
// n çš„å–å€¼èŒƒå›´ä¸º [0, 100] 
// 
// Related Topics è´ªå¿ƒ æ•°ç»„ å“ˆå¸Œè¡¨ è®¡æ•° æ’åº å †ï¼ˆä¼˜å…ˆé˜Ÿåˆ—ï¼‰ ğŸ‘ 850 ğŸ‘ 0


import java.util.Arrays;
import java.util.Map;
import java.util.PriorityQueue;

//leetcode submit region begin(Prohibit modification and deletion)
class Solution621 {
    /**
     * ä¸‹é¢çš„è¿›å…¥äº†ç»†èŠ‚åœ°ç‹±, æœ‰äº›æƒ…å†µæ˜¯é”™çš„, å‚è€ƒè¿‡ç­”æ¡ˆåå°è¯•ä»å…¨å±€æ¥å®Œæˆè¿™ä¸ªè°ƒåº¦æµç¨‹
     * 1. å°†ä»»åŠ¡æŒ‰ç±»å‹åˆ†ç»„, ç„¶åæŒ‰ç…§ä»»åŠ¡æ•°é‡æ’åº
     * 2. ä¼˜å…ˆæ’åˆ—æ•°é‡æœ€å¤šçš„ä»»åŠ¡, è¿™ä¸ªä»»åŠ¡å¿…å æ—¶é—´ (count-1) * (n+1) + 1
     * 3. å¦‚æœåé¢çš„ä»»åŠ¡æ•°é‡å’Œæœ€å¤šçš„ä¸€æ ·å¤š, é‚£ä¹ˆæ¯æ¬¡éœ€è¦åœ¨åŸæ¥çš„åŸºç¡€ä¸Š +1 (æœ€åä¸€ä¸ªä»»åŠ¡æ’åœ¨å‰ä¸€ä¸ªä»»åŠ¡åé¢)
     * 4. ç»è¿‡ä¸Šè¿°ä¸‰æ­¥æ“ä½œä¹‹å, æœ€å¼€å§‹çš„ç©ºéš™åªæœ‰å¡«æ»¡å’Œæ²¡æœ‰å¡«æ»¡ä¸¤ç§å¯èƒ½.
     *    a. å¦‚æœç©ºä½éƒ½æ’æ»¡è¿˜æœ‰ä»»åŠ¡, é‚£ä¹ˆè®¡ç®—çš„ä»»åŠ¡æ—¶é—´è‚¯å®šæ¯” tasks.len å°, ç»“æœåº”è¯¥æ˜¯ tasks.len
     *    b. å¦‚æœç©ºä½æ²¡æœ‰å¡«æ»¡, é‚£ä¹ˆè®¡ç®—çš„æ—¶é—´è‚¯å®šæ¯” tasks.len å¤§, ç»“æœåº”è¯¥æ˜¯è®¡ç®—çš„æ—¶é—´
     */
    public int leastInterval_v2(char[] tasks, int n) {
        // 1. å°†ä»»åŠ¡æŒ‰ç±»å‹åˆ†ç»„, ç„¶åæŒ‰ç…§ä»»åŠ¡æ•°é‡æ’åº
        int[] count = new int[26];
        for (char task: tasks) {
            count[task - 'A']++;
        }
        Arrays.sort(count);

        // 2. ä¼˜å…ˆæ’åˆ—æ•°é‡æœ€å¤šçš„ä»»åŠ¡, è¿™ä¸ªä»»åŠ¡å¿…å æ—¶é—´ (count-1) * (n+1) + 1
        int ret = (count[25] - 1) * (n+1) + 1;

        // 3. å¦‚æœåé¢çš„ä»»åŠ¡æ•°é‡å’Œæœ€å¤šçš„ä¸€æ ·å¤š, é‚£ä¹ˆæ¯æ¬¡éœ€è¦åœ¨åŸæ¥çš„åŸºç¡€ä¸Š +1 (æœ€åä¸€ä¸ªä»»åŠ¡æ’åœ¨å‰ä¸€ä¸ªä»»åŠ¡åé¢)
        for (int i = 24; i >= 0; i--) {
            if (count[i] != count[i+1])
                break;
            ret++;
        }
        // 4. ç»è¿‡ä¸Šè¿°ä¸‰æ­¥æ“ä½œä¹‹å, æœ€å¼€å§‹çš„ç©ºéš™åªæœ‰å¡«æ»¡å’Œæ²¡æœ‰å¡«æ»¡ä¸¤ç§å¯èƒ½.
        return Math.max(ret, tasks.length);
    }

    /**
     * ä¸€èˆ¬æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—æ¥å®ç°, è¿™ä¸ªé¢˜æ€ä¹ˆåšå‘¢, æœ‰æ—¶é•¿ä¸º n çš„å†·é™æœŸ
     * è¯•ç€æ¨¡æ‹Ÿä¸‹è°ƒåº¦è¿‡ç¨‹, èƒ½ç»§ç»­è°ƒåº¦å°±è°ƒåº¦, ä¸èƒ½ç»§ç»­è°ƒåº¦å°±ç­‰
     * æ„Ÿè§‰è¿™ä¸ªå¯ä»¥ç›´æ¥ç”¨æ•°å­¦ç®—å‡ºæ¥, ä½†æˆ‘ä¸çŸ¥é“æ€ä¹ˆç®—
     * ['A','A','A','B','B','B', 'C','C','C', 'D', 'D', 'E'], n = 2
     * å¯¹ä¸Šè¿°åºåˆ—, èƒ½è°ƒåº¦å°±è°ƒåº¦ç®—å‡ºæ¥çš„æ—¶é—´æ˜¯ 13, ä½†å¦‚æœå°½å¯èƒ½æ‰¾ä¸€ä¸ªå†·é™æœŸæœ€é•¿çš„, è®¡ç®—å‡ºæ¥æ˜¯ 12
     * å³è´ªå¿ƒçš„æ€è·¯
     *
     * å‘ç°å†·é™æœŸæœ€é•¿ä¹Ÿä¸æ˜¯æœ€ä¼˜è§£
     * ["A","A","A","A","A","A","B","C","D","E","F","G"], n = 2
     * æœ€ä¼˜çš„å†·é™æœŸåº”è¯¥æ˜¯å½“å‰é‡å¤ä»»åŠ¡çš„ç»„æ•° - 1
     *
     * è¿˜éœ€è¦ä¸€ä¸ªå‰æ, é‡å¤æœ€å¤šçš„ä»»åŠ¡è¶Šæ’åœ¨å‰é¢
     *
     * è¿™æ˜¯ä¸‹é¢ç‰ˆæœ¬çš„ä¿®æ­£
     * çœ‹äº†ç­”æ¡ˆåçš„æ€è€ƒ.
     * é—®é¢˜å½’ç±»: å¦‚æœå½“å‰æœ‰å¤šç§ä»»åŠ¡ä¸åœ¨å†·å´ä¸­, æˆ‘ä»¬åº”è¯¥å¦‚ä½•æŒ‘é€‰å®šæ—¶ä»»åŠ¡çš„é—®é¢˜
     * ç­”æ¡ˆ: ä¸åœ¨å†·å´ä¸­, å‰©ä½™æ¬¡æ•°æœ€å¤šçš„é‚£ä¸ªä»»åŠ¡
     *
     * æ‰€ä»¥æ˜¨å¤©çš„å‰æ, é‡å¤æœ€å¤šçš„ä»»åŠ¡æ’åœ¨å‰é¢å°±å¤Ÿäº†, æ²¡æœ‰æœ€ä¼˜å†·é™æœŸä¸€è¯´
     */
    public int leastInterval_v1(char[] tasks, int n) {
        // è°ƒåº¦æ—¶é’Ÿ
        int time = 0;
        // ä»»åŠ¡æ•°é‡
        int num = tasks.length;
        // ä»»åŠ¡ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´
        int[] timeRecord = new int[26];
        Arrays.fill(timeRecord, -n);

        // ç»Ÿè®¡ä¸‹ä»»åŠ¡æ•°é‡
        // [0] è®°å½•ä»»åŠ¡ id, [1] è®°å½•ä»»åŠ¡å‡ºç°æ¬¡æ•°
        int[][] count = new int[26][2];
        for (char c: tasks) {
            count[c-'A'][0] = c-'A';
            count[c-'A'][1]++;
        }

        // ä¼˜å…ˆçº§é˜Ÿåˆ—, ä»»åŠ¡è¶Šå¤šçš„æ’è¶Šå‰é¢
        Arrays.sort(count, (e1, e2) -> e2[1] - e1[1]);

        while (num > 0) {
            // æ¯æ¬¡è°ƒåº¦æ—¶é’Ÿ + 1
            time++;
            // å°è¯•è°ƒåº¦, å¯èƒ½æ˜¯ä¸€æ¬¡ç©ºè°ƒåº¦
            // è¿™é‡Œåº”è¯¥å°è¯•è´ªå¿ƒçš„æ€è·¯, æ‰¾ä¸€ä¸ªå†·é™æœŸæœ€é•¿çš„
            for (int i = 0; i < count.length; i++) {
                int[] select = count[i];
                int this_duration = time - timeRecord[select[0]];
                if (select[1] > 0 && this_duration > n) {
                    // è¯¥ç±»å‹ä»»åŠ¡æ•°é‡å‡ 1
                    select[1]--;
                    // è®°å½•æ–°çš„æ—¶é—´
                    timeRecord[select[0]] = time;
                    // ä»»åŠ¡æ•°é‡å‡ 1
                    num--;

                    // æ¯æ¬¡æˆ‘ä»¬éƒ½éœ€è¦é€‰å½“å‰ä¸åœ¨å†·é™æœŸ, æ•°é‡æœ€å¤šçš„ä»»åŠ¡, æ‰€ä»¥è¦ä¿è¯æ•°é‡æœ€å¤šçš„ä»»åŠ¡å§‹ç»ˆåœ¨æœ€å‰é¢
                    if (i < count.length - 1 && select[1] < count[i+1][1]) {
                        count[i] = count[i+1];
                        count[i+1] = select;
                    }
                    break;
                }
            }

        }
        return time;
    }

    /**
     * ä¸€èˆ¬æ“ä½œç³»ç»Ÿçš„ä»»åŠ¡è°ƒåº¦ä½¿ç”¨ä¼˜å…ˆé˜Ÿåˆ—æ¥å®ç°, è¿™ä¸ªé¢˜æ€ä¹ˆåšå‘¢, æœ‰æ—¶é•¿ä¸º n çš„å†·é™æœŸ
     * è¯•ç€æ¨¡æ‹Ÿä¸‹è°ƒåº¦è¿‡ç¨‹, èƒ½ç»§ç»­è°ƒåº¦å°±è°ƒåº¦, ä¸èƒ½ç»§ç»­è°ƒåº¦å°±ç­‰
     * æ„Ÿè§‰è¿™ä¸ªå¯ä»¥ç›´æ¥ç”¨æ•°å­¦ç®—å‡ºæ¥, ä½†æˆ‘ä¸çŸ¥é“æ€ä¹ˆç®—
     * ['A','A','A','B','B','B', 'C','C','C', 'D', 'D', 'E'], n = 2
     * å¯¹ä¸Šè¿°åºåˆ—, èƒ½è°ƒåº¦å°±è°ƒåº¦ç®—å‡ºæ¥çš„æ—¶é—´æ˜¯ 13, ä½†å¦‚æœå°½å¯èƒ½æ‰¾ä¸€ä¸ªå†·é™æœŸæœ€é•¿çš„, è®¡ç®—å‡ºæ¥æ˜¯ 12
     * å³è´ªå¿ƒçš„æ€è·¯
     *
     * å‘ç°å†·é™æœŸæœ€é•¿ä¹Ÿä¸æ˜¯æœ€ä¼˜è§£
     * ["A","A","A","A","A","A","B","C","D","E","F","G"], n = 2
     * æœ€ä¼˜çš„å†·é™æœŸåº”è¯¥æ˜¯å½“å‰é‡å¤ä»»åŠ¡çš„ç»„æ•° - 1
     *
     * è¿˜éœ€è¦ä¸€ä¸ªå‰æ, é‡å¤æœ€å¤šçš„ä»»åŠ¡è¶Šæ’åœ¨å‰é¢
     */
    public int leastInterval(char[] tasks, int n) {
        // è°ƒåº¦æ—¶é’Ÿ
        int time = 0;
        // ä»»åŠ¡æ•°é‡
        int num = tasks.length;
        // ä»»åŠ¡ä¸Šæ¬¡æ‰§è¡Œæ—¶é—´
        int[] timeRecord = new int[26];
        Arrays.fill(timeRecord, -n);

        // ç»Ÿè®¡ä¸‹ä»»åŠ¡æ•°é‡
        // [0] è®°å½•ä»»åŠ¡ id, [1] è®°å½•ä»»åŠ¡å‡ºç°æ¬¡æ•°
        int[][] count = new int[26][2];
        // è®°å½•é‡å¤ä»»åŠ¡çš„ç»„æ•°
        int group = 0;
        for (char c: tasks) {
            count[c-'A'][0] = c-'A';
            if (++count[c-'A'][1] == 2)
                // è¶…è¿‡ 1 çš„æ—¶å€™, è®°å½•ä¸€æ¬¡
                group++;
        }
        // ä¼˜å…ˆçº§é˜Ÿåˆ—, ä»»åŠ¡è¶Šå¤šçš„æ’è¶Šå‰é¢
        Arrays.sort(count, (e1, e2) -> e2[1] - e1[1]);

        while (num > 0) {
            // æ¯æ¬¡è°ƒåº¦æ—¶é’Ÿ + 1
            time++;
            // å°è¯•è°ƒåº¦, å¯èƒ½æ˜¯ä¸€æ¬¡ç©ºè°ƒåº¦
            // è¿™é‡Œåº”è¯¥å°è¯•è´ªå¿ƒçš„æ€è·¯, æ‰¾ä¸€ä¸ªå†·é™æœŸæœ€é•¿çš„
            int[] select = null;
            int best_duration = Math.max(n, group-1);
            for (int[] task: count) {
                int this_duration = time - timeRecord[task[0]];
                if (task[1] > 0 && this_duration > n) {
                    select = task;
                    if (this_duration > best_duration) {
                        break;
                    }
                }
            }
            if (select != null) {
                // ä»é‡å¤å˜æˆæ— é‡å¤ä¹‹å, é‡å¤æ•°é‡å‡å»ä¸€
                if (--select[1] == 1)
                    group--;
                // è®°å½•æ–°çš„æ—¶é—´
                timeRecord[select[0]] = time;
                // ä»»åŠ¡æ•°é‡å‡ 1
                num--;
            }
        }
        return time;
    }

    public static void main(String[] args) {
        char[] tasks = new char[]{'A','A','A','B','B','B', 'C','C','C', 'D', 'D', 'E'};
        Solution621 solution621 = new Solution621();
        solution621.leastInterval(tasks, 2);
    }
}
//leetcode submit region end(Prohibit modification and deletion)
